<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Greenfield API example with Node.js (JavaScript) | BTCPay Server</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="stylesheet" href="/styles/btcpayserver-variables.css">
    <meta name="description" content="BTCPay Server Official Documentation">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    
    <link rel="preload" href="/assets/css/0.styles.5d7f2299.css" as="style"><link rel="preload" href="/assets/js/app.d50c8245.js" as="script"><link rel="preload" href="/assets/js/2.04ab019e.js" as="script"><link rel="preload" href="/assets/js/126.ef170f03.js" as="script"><link rel="prefetch" href="/assets/js/1.5a951dd8.js"><link rel="prefetch" href="/assets/js/100.d4cddc62.js"><link rel="prefetch" href="/assets/js/101.955b1324.js"><link rel="prefetch" href="/assets/js/102.1e69681c.js"><link rel="prefetch" href="/assets/js/103.b0e70c7b.js"><link rel="prefetch" href="/assets/js/104.18bf39ce.js"><link rel="prefetch" href="/assets/js/105.ddc8676b.js"><link rel="prefetch" href="/assets/js/106.e8618108.js"><link rel="prefetch" href="/assets/js/107.a463f888.js"><link rel="prefetch" href="/assets/js/108.1bde951b.js"><link rel="prefetch" href="/assets/js/109.eff2103e.js"><link rel="prefetch" href="/assets/js/110.13a9b308.js"><link rel="prefetch" href="/assets/js/111.1819e2bd.js"><link rel="prefetch" href="/assets/js/112.82090a53.js"><link rel="prefetch" href="/assets/js/113.34b53002.js"><link rel="prefetch" href="/assets/js/114.d724de49.js"><link rel="prefetch" href="/assets/js/115.debb5bc9.js"><link rel="prefetch" href="/assets/js/116.b652d17a.js"><link rel="prefetch" href="/assets/js/117.66a0f7bf.js"><link rel="prefetch" href="/assets/js/118.e5af34aa.js"><link rel="prefetch" href="/assets/js/119.2ed902a2.js"><link rel="prefetch" href="/assets/js/12.6c3a8671.js"><link rel="prefetch" href="/assets/js/120.10f3a37e.js"><link rel="prefetch" href="/assets/js/121.883ba361.js"><link rel="prefetch" href="/assets/js/122.d7141dab.js"><link rel="prefetch" href="/assets/js/123.30657657.js"><link rel="prefetch" href="/assets/js/124.3bd805b5.js"><link rel="prefetch" href="/assets/js/125.1abef3b1.js"><link rel="prefetch" href="/assets/js/127.0fd3eeb5.js"><link rel="prefetch" href="/assets/js/128.ddd96668.js"><link rel="prefetch" href="/assets/js/129.1012095c.js"><link rel="prefetch" href="/assets/js/13.d9559f4e.js"><link rel="prefetch" href="/assets/js/130.d2c8df6c.js"><link rel="prefetch" href="/assets/js/131.fc4520f1.js"><link rel="prefetch" href="/assets/js/132.a6253083.js"><link rel="prefetch" href="/assets/js/133.01afc6ea.js"><link rel="prefetch" href="/assets/js/134.34e8d418.js"><link rel="prefetch" href="/assets/js/135.6bfb45ec.js"><link rel="prefetch" href="/assets/js/136.dfd530f5.js"><link rel="prefetch" href="/assets/js/137.8956159c.js"><link rel="prefetch" href="/assets/js/138.2b8e3a7c.js"><link rel="prefetch" href="/assets/js/139.8425da6c.js"><link rel="prefetch" href="/assets/js/14.67dedfd2.js"><link rel="prefetch" href="/assets/js/140.1044f935.js"><link rel="prefetch" href="/assets/js/141.700e1173.js"><link rel="prefetch" href="/assets/js/142.bc805494.js"><link rel="prefetch" href="/assets/js/143.1e6c4c97.js"><link rel="prefetch" href="/assets/js/144.bae7f4f6.js"><link rel="prefetch" href="/assets/js/145.dc3c8ce5.js"><link rel="prefetch" href="/assets/js/146.0732c044.js"><link rel="prefetch" href="/assets/js/147.10285427.js"><link rel="prefetch" href="/assets/js/148.9b0bc75f.js"><link rel="prefetch" href="/assets/js/149.b6c5b769.js"><link rel="prefetch" href="/assets/js/15.6eabb681.js"><link rel="prefetch" href="/assets/js/150.942a29d4.js"><link rel="prefetch" href="/assets/js/151.a9b2cc69.js"><link rel="prefetch" href="/assets/js/152.2e3e376e.js"><link rel="prefetch" href="/assets/js/153.d538173f.js"><link rel="prefetch" href="/assets/js/154.ce635c3c.js"><link rel="prefetch" href="/assets/js/155.d589c522.js"><link rel="prefetch" href="/assets/js/156.3fe27bd4.js"><link rel="prefetch" href="/assets/js/157.eca1c8cc.js"><link rel="prefetch" href="/assets/js/158.e9e06cf6.js"><link rel="prefetch" href="/assets/js/159.f4ac3ffa.js"><link rel="prefetch" href="/assets/js/16.503e1e9f.js"><link rel="prefetch" href="/assets/js/160.41d38d10.js"><link rel="prefetch" href="/assets/js/161.3d0ce602.js"><link rel="prefetch" href="/assets/js/162.ba38fe61.js"><link rel="prefetch" href="/assets/js/163.cc386a6f.js"><link rel="prefetch" href="/assets/js/164.f3ab0652.js"><link rel="prefetch" href="/assets/js/165.c1da5406.js"><link rel="prefetch" href="/assets/js/166.16b15295.js"><link rel="prefetch" href="/assets/js/167.196e7bf0.js"><link rel="prefetch" href="/assets/js/168.cc514026.js"><link rel="prefetch" href="/assets/js/169.80f1d46a.js"><link rel="prefetch" href="/assets/js/17.1a9b7e08.js"><link rel="prefetch" href="/assets/js/170.9dc23df1.js"><link rel="prefetch" href="/assets/js/171.aa742c39.js"><link rel="prefetch" href="/assets/js/172.e79e6c43.js"><link rel="prefetch" href="/assets/js/173.33be0084.js"><link rel="prefetch" href="/assets/js/174.2a4ca743.js"><link rel="prefetch" href="/assets/js/18.0aa810bf.js"><link rel="prefetch" href="/assets/js/19.8eb9db3d.js"><link rel="prefetch" href="/assets/js/20.7f6622c9.js"><link rel="prefetch" href="/assets/js/21.2f1996e0.js"><link rel="prefetch" href="/assets/js/22.5d258c45.js"><link rel="prefetch" href="/assets/js/23.f7f25ea8.js"><link rel="prefetch" href="/assets/js/24.48e65c21.js"><link rel="prefetch" href="/assets/js/25.7c31599e.js"><link rel="prefetch" href="/assets/js/26.5b69a7bb.js"><link rel="prefetch" href="/assets/js/27.38ff8707.js"><link rel="prefetch" href="/assets/js/28.ead0123d.js"><link rel="prefetch" href="/assets/js/29.6a840def.js"><link rel="prefetch" href="/assets/js/3.f577f6b3.js"><link rel="prefetch" href="/assets/js/30.52bb52fd.js"><link rel="prefetch" href="/assets/js/31.75e39bc2.js"><link rel="prefetch" href="/assets/js/32.f1e11b0c.js"><link rel="prefetch" href="/assets/js/33.58709485.js"><link rel="prefetch" href="/assets/js/34.00697296.js"><link rel="prefetch" href="/assets/js/35.a767f69f.js"><link rel="prefetch" href="/assets/js/36.58552e89.js"><link rel="prefetch" href="/assets/js/37.d90f85a9.js"><link rel="prefetch" href="/assets/js/38.8daa116e.js"><link rel="prefetch" href="/assets/js/39.cffecf03.js"><link rel="prefetch" href="/assets/js/4.36b1967c.js"><link rel="prefetch" href="/assets/js/40.2675daed.js"><link rel="prefetch" href="/assets/js/41.8c88653c.js"><link rel="prefetch" href="/assets/js/42.734e8cfc.js"><link rel="prefetch" href="/assets/js/43.575e17d5.js"><link rel="prefetch" href="/assets/js/44.8a68ff8b.js"><link rel="prefetch" href="/assets/js/45.535dd3b4.js"><link rel="prefetch" href="/assets/js/46.d2176325.js"><link rel="prefetch" href="/assets/js/47.d86abe24.js"><link rel="prefetch" href="/assets/js/48.65cdcd3f.js"><link rel="prefetch" href="/assets/js/49.e57b1699.js"><link rel="prefetch" href="/assets/js/5.0165a0f6.js"><link rel="prefetch" href="/assets/js/50.23956b7a.js"><link rel="prefetch" href="/assets/js/51.92ceb24d.js"><link rel="prefetch" href="/assets/js/52.8ce28c86.js"><link rel="prefetch" href="/assets/js/53.de027ba8.js"><link rel="prefetch" href="/assets/js/54.65536b58.js"><link rel="prefetch" href="/assets/js/55.6440a4c7.js"><link rel="prefetch" href="/assets/js/56.f4cedb37.js"><link rel="prefetch" href="/assets/js/57.bbcc2d66.js"><link rel="prefetch" href="/assets/js/58.9effe11c.js"><link rel="prefetch" href="/assets/js/59.4f4df784.js"><link rel="prefetch" href="/assets/js/6.59cef49e.js"><link rel="prefetch" href="/assets/js/60.da9ed9f3.js"><link rel="prefetch" href="/assets/js/61.e9c69963.js"><link rel="prefetch" href="/assets/js/62.340e5ad9.js"><link rel="prefetch" href="/assets/js/63.677b3b18.js"><link rel="prefetch" href="/assets/js/64.06efc71c.js"><link rel="prefetch" href="/assets/js/65.9d493b89.js"><link rel="prefetch" href="/assets/js/66.63f8b22a.js"><link rel="prefetch" href="/assets/js/67.54a7ab52.js"><link rel="prefetch" href="/assets/js/68.43f703a0.js"><link rel="prefetch" href="/assets/js/69.cc2e5201.js"><link rel="prefetch" href="/assets/js/7.75a814b4.js"><link rel="prefetch" href="/assets/js/70.eb948ec6.js"><link rel="prefetch" href="/assets/js/71.bf7e8887.js"><link rel="prefetch" href="/assets/js/72.e13a8822.js"><link rel="prefetch" href="/assets/js/73.593f911e.js"><link rel="prefetch" href="/assets/js/74.7cddc58a.js"><link rel="prefetch" href="/assets/js/75.5778eccf.js"><link rel="prefetch" href="/assets/js/76.c40b59c5.js"><link rel="prefetch" href="/assets/js/77.8c1acb76.js"><link rel="prefetch" href="/assets/js/78.966a2525.js"><link rel="prefetch" href="/assets/js/79.08f99d4e.js"><link rel="prefetch" href="/assets/js/8.d5d14c9e.js"><link rel="prefetch" href="/assets/js/80.b3913aa5.js"><link rel="prefetch" href="/assets/js/81.44190403.js"><link rel="prefetch" href="/assets/js/82.826e06e0.js"><link rel="prefetch" href="/assets/js/83.4ee26d2e.js"><link rel="prefetch" href="/assets/js/84.292698fb.js"><link rel="prefetch" href="/assets/js/85.94d0757c.js"><link rel="prefetch" href="/assets/js/86.e638dec7.js"><link rel="prefetch" href="/assets/js/87.db9a2581.js"><link rel="prefetch" href="/assets/js/88.8b911852.js"><link rel="prefetch" href="/assets/js/89.edc797a1.js"><link rel="prefetch" href="/assets/js/9.cad02ca3.js"><link rel="prefetch" href="/assets/js/90.3960c592.js"><link rel="prefetch" href="/assets/js/91.9746606e.js"><link rel="prefetch" href="/assets/js/92.6bc7a5e0.js"><link rel="prefetch" href="/assets/js/93.ee267607.js"><link rel="prefetch" href="/assets/js/94.c3a9af9d.js"><link rel="prefetch" href="/assets/js/95.cb6e6edb.js"><link rel="prefetch" href="/assets/js/96.fba85f30.js"><link rel="prefetch" href="/assets/js/97.1bd714dd.js"><link rel="prefetch" href="/assets/js/98.43b355b5.js"><link rel="prefetch" href="/assets/js/99.63a8e32c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.839f0d09.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d7f2299.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/btcpay-logo.svg" alt="BTCPay Server" class="logo"> <span class="site-name can-hide">BTCPay Server</span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Guide/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/Deployment/" class="nav-link">
  Deployment
</a></div><div class="nav-item"><a href="/Development/" class="nav-link router-link-active">
  Developers
</a></div><div class="nav-item"><a href="/Contribute/" class="nav-link">
  Contribute
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link">
  FAQ
</a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide social"><div class="nav-item"><a href="https://btcpayserver.org/" target="_blank" rel="noopener noreferrer website" class="nav-link external">
  Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://chat.btcpayserver.org/" target="_blank" rel="noopener noreferrer chat" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/btcpayserver/" target="_blank" rel="noopener noreferrer github" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/BtcpayServer" target="_blank" rel="noopener noreferrer twitter" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <button type="button" class="btcpay-theme-switch"><svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path transform="translate(1 1)" d="M2.72 0A3.988 3.988 0 000 3.78c0 2.21 1.79 4 4 4 1.76 0 3.25-1.14 3.78-2.72-.4.13-.83.22-1.28.22-2.21 0-4-1.79-4-4 0-.45.08-.88.22-1.28z" class="btcpay-theme-switch-dark"></path><path transform="translate(1 1)" d="M4 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5S4.28 0 4 0zM1.5 1c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm5 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM4 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM.5 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM1.5 6c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm5 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM4 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5S4.28 7 4 7z" class="btcpay-theme-switch-light"></path></svg></button></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links social"><div class="nav-item"><a href="https://btcpayserver.org/" target="_blank" rel="noopener noreferrer website" class="nav-link external">
  Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://chat.btcpayserver.org/" target="_blank" rel="noopener noreferrer chat" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/btcpayserver/" target="_blank" rel="noopener noreferrer github" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/BtcpayServer" target="_blank" rel="noopener noreferrer twitter" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <nav class="nav-links"><div class="nav-item"><a href="/Guide/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/Deployment/" class="nav-link">
  Deployment
</a></div><div class="nav-item"><a href="/Development/" class="nav-link router-link-active">
  Developers
</a></div><div class="nav-item"><a href="/Contribute/" class="nav-link">
  Contribute
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link">
  FAQ
</a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Greenfield API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="https://docs.btcpayserver.org/API/Greenfield/v1" target="_blank" rel="noopener noreferrer" class="sidebar-link">Greenfield API v1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="/Development/ecommerce-integration-guide/" class="sidebar-link">eCommerce Integration Guide</a></li><li><a href="/BTCPayServer/greenfield-authorization/" class="sidebar-link">GreenField API Authorization Flow</a></li><li><a href="/Development/GreenFieldExample/" class="sidebar-link">Greenfield API example with cURL</a></li><li><a href="/Development/GreenFieldExample-NodeJS/" aria-current="page" class="active sidebar-link">Greenfield API example with Node.js (JavaScript)</a></li><li><a href="/Development/GreenfieldExample-PHP/" class="sidebar-link">Greenfield API examples with PHP</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Development</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Development/" aria-current="page" class="sidebar-link">Architecture</a></li><li><a href="/Development/LocalDevelopment/" class="sidebar-link">Local development</a></li><li><a href="/BTCPayServer/greenfield-development/" class="sidebar-link">Greenfield API Development</a></li><li><a href="/Development/Plugins/" class="sidebar-link">Plugins</a></li><li><a href="/Development/Altcoins/" class="sidebar-link">How to add an Altcoin</a></li><li><a href="/Development/InvoiceMetadata/" class="sidebar-link">Invoice metadata</a></li><li><a href="/Development/Theme/" class="sidebar-link">Customizing themes</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>NBXplorer</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NBXplorer/" class="sidebar-link">Overview</a></li><li><a href="/NBXplorer/API/" class="sidebar-link">API Specification</a></li><li><a href="/NBXplorer/Postgres-Schema/" class="sidebar-link">Postgres Schema</a></li><li><a href="/NBXplorer/Postgres-Migration/" class="sidebar-link">Postgres Migration</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>More</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Vault/" class="sidebar-heading clickable"><span>BTCPay Server Vault</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/BTCPayServer/Security/" class="sidebar-link">Security Disclosures</a></li><li><a href="/Development/TestnetDemo/" class="sidebar-link">Testnet deployment</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="greenfield-api-example-with-nodejs-javascript"><a href="#greenfield-api-example-with-nodejs-javascript" class="header-anchor">#</a> Greenfield API example with Node.js (JavaScript)</h1> <p>The <strong><a href="https://docs.btcpayserver.org/API/Greenfield/v1/" target="_blank" rel="noopener noreferrer">Greenfield API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong> (also available on your instance on <code>/docs</code>) allows you to operate BTCPay Server via an easy-to-use REST API.</p> <p>Note that you can partially generate clients in the language of your choice by using the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/swagger.json" target="_blank" rel="noopener noreferrer">Swagger file<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>In this guide, we will show you how to use it using Node.js/JavaScript.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>Unless for a few endpoints like creating a store and API key on behalf of a specific user, Basic Auth should be avoided and an API key should be used instead. Make sure that API keys only have the needed permissions and not more. E.g. if you only create invoices you should not give the API key the permission to manage your stores.</p> <p>You can create a new API key in the BTCPay Server UI under <code>Account</code> -&gt; <code>Manage account</code> -&gt; <code>API keys</code></p> <p>For the ecommerce examples below the API key needs the following permissions:</p> <ul><li>View invoices</li> <li>Create invoice</li> <li>Modify invoices</li> <li>Modify stores webhooks</li> <li>View your stores</li> <li>Create non-approved pull payments</li></ul> <p>For an overview of available permissions see the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#section/Authentication/API_Key" target="_blank" rel="noopener noreferrer">API documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or the permissions documented on each endpoint.</p> <h2 id="ecommerce-examples"><a href="#ecommerce-examples" class="header-anchor">#</a> eCommerce examples</h2> <p>The following examples will show you how to create a basic eCommerce flow using the Greenfield API by creating an invoice, registering a webhook, processing webhooks, and issuing a full refund of an invoice.</p> <h3 id="create-an-invoice"><a href="#create-an-invoice" class="header-anchor">#</a> Create an invoice</h3> <p>We create an invoice using the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Invoices_CreateInvoice" target="_blank" rel="noopener noreferrer">create invoice endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This is a simple example but you can set a lot more data like order id, buyer email or custom metadata. That said, don't store redundant data on the invoice to prevent data leaks in case of a hack. E.g. in most cases it makes no sense to store the customer address on your eCommerce system and also on the BTCPay invoice.</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btcpayServerUrl <span class="token operator">=</span> <span class="token string">'https://mainnet.demo.btcpayserver.org'</span>
<span class="token keyword">const</span> storeId <span class="token operator">=</span> <span class="token string">'YOUR_STORE_ID'</span>
<span class="token keyword">const</span> apiKey <span class="token operator">=</span> <span class="token string">'YOUR_API_KEY'</span>
<span class="token keyword">const</span> amount <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">const</span> currency <span class="token operator">=</span> <span class="token string">'USD'</span>

<span class="token keyword">const</span> apiEndpoint <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/v1/stores/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>storeId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/invoices</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">'token '</span> <span class="token operator">+</span> apiKey
<span class="token punctuation">}</span>
<span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">amount</span><span class="token operator">:</span> amount<span class="token punctuation">,</span>
  <span class="token literal-property property">currency</span><span class="token operator">:</span> currency
<span class="token punctuation">}</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>btcpayServerUrl <span class="token operator">+</span> apiEndpoint<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> headers<span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="register-a-webhook-optional"><a href="#register-a-webhook-optional" class="header-anchor">#</a> Register a webhook (optional)</h3> <p>Let's register a webhook to be notified when the invoice is paid. You can use the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Webhooks_CreateWebhook" target="_blank" rel="noopener noreferrer">create webhook endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to register a webhook.</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btcpayServerUrl <span class="token operator">=</span> <span class="token string">'https://mainnet.demo.btcpayserver.org'</span>
<span class="token keyword">const</span> storeId <span class="token operator">=</span> <span class="token string">'YOUR_STORE_ID'</span>
<span class="token keyword">const</span> apiKey <span class="token operator">=</span> <span class="token string">'YOUR_API_KEY'</span>

<span class="token keyword">const</span> apiEndpoint <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/v1/stores/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>storeId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/webhooks</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">'token '</span> <span class="token operator">+</span> apiKey
<span class="token punctuation">}</span>

<span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://example.com/your-webhook-endpoint'</span>
<span class="token punctuation">}</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>btcpayServerUrl <span class="token operator">+</span> apiEndpoint<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> headers<span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>This step is optional, you can also manually create a webhook in the BTCPay Server UI in your store <code>Settings</code> -&gt; <code>Webhooks</code>.</p> <h3 id="validate-and-process-webhooks"><a href="#validate-and-process-webhooks" class="header-anchor">#</a> Validate and process webhooks</h3> <p>You can use your Node.js Express web application to receive webhook requests from your BTCPay Server.</p> <p>First you need a route so that your Node.js application can receive POST requests.
Based on how you set up the express server this should look something like this:</p> <div class="language-JS extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/your-webhook-endpoint'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do stuff here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>What's important is that the webhook sends a HTTP-header <code>BTCPAY-SIG</code> which is the signed request using the <code>secret</code> you got back from the previous step when registering the webhook. You can use that <code>secret</code> and the raw payload (as bytes) you get from the webhook, hash it and compare it to <code>BTCPAY-SIG</code>. Therefore, you need <code>body-parser</code> which is a middleware to parse the raw body of the request. For comparing the hashes you also need <code>crypto</code> which is a built-in Node.js module.</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>
</code></pre></div><p>You can parse the raw body of the request like this:</p> <div class="language-JS extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">verify</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> buf</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span>rawBody <span class="token operator">=</span> buf
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>This makes sure that in req.rawBody the correct content is parsed so that you can compare the hashed req.rawBody with the <code>BTCPAY-SIG</code> header value.</p> <p>However, if you are using TypeScript, you might run into this error:</p> <div class="language- extra-class"><pre class="language-text"><code>Property 'rawBody' does not exist on type 'Request'.
</code></pre></div><p>The temporary fix is to use the <code>as</code> keyword to tell the compiler to consider the <code>req</code> object as another type when you accessing the <code>rawBody</code>. Here is an example of how to obtain <code>rawBody</code> using this workaround, no need for the middleware code above:</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Request<span class="token punctuation">,</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express-serve-static-core&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> https <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;firebase-functions&quot;</span><span class="token punctuation">;</span>

type FirebaseRequest <span class="token operator">=</span> https<span class="token punctuation">.</span>Request

<span class="token keyword">const</span> <span class="token function-variable function">myFunc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">req</span><span class="token operator">:</span> Request<span class="token punctuation">,</span> <span class="token literal-property property">res</span><span class="token operator">:</span> Response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rawBody <span class="token operator">=</span> <span class="token punctuation">(</span>req <span class="token keyword">as</span> FirebaseRequest<span class="token punctuation">)</span><span class="token punctuation">.</span>rawBody<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Replace <code>req.rawBody</code> with <code>rawBody</code> in the next sections if utilizing this method with TypeScript.</p> <p>In your router it looks like this put all together: (Change <code>webhookSecret</code> with the <code>secret</code> you got back from the previous step when registering the webhook).</p> <div class="language-JS extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/your-webhook-endpoint'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sigHashAlg <span class="token operator">=</span> <span class="token string">'sha256'</span>
  <span class="token keyword">const</span> sigHeaderName <span class="token operator">=</span> <span class="token string">'BTCPAY-SIG'</span>
  <span class="token keyword">const</span> webhookSecret <span class="token operator">=</span> <span class="token string">'SECRET_FROM_REGISTERING_WEBHOOK'</span> <span class="token comment">// see previous step</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>rawBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Request body empty'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> checksum <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sigHeaderName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> hmac <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHmac</span><span class="token punctuation">(</span>sigHashAlg<span class="token punctuation">,</span> webhookSecret<span class="token punctuation">)</span>
  <span class="token keyword">const</span> digest <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>
    sigHashAlg <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> hmac<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>rawBody<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'utf8'</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    checksum<span class="token punctuation">.</span>length <span class="token operator">!==</span> digest<span class="token punctuation">.</span>length <span class="token operator">||</span>
    <span class="token operator">!</span>crypto<span class="token punctuation">.</span><span class="token function">timingSafeEqual</span><span class="token punctuation">(</span>digest<span class="token punctuation">,</span> checksum<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request body digest (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>digest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) did not match </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sigHeaderName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>checksum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request body digest (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>digest<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) did not match </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sigHeaderName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>checksum<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

    <span class="token comment">// Your own processing code goes here. E.g. update your internal order id depending on the invoice payment status.</span>

    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Success: request body was signed'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="issue-a-full-refund-of-an-invoice"><a href="#issue-a-full-refund-of-an-invoice" class="header-anchor">#</a> Issue a full refund of an invoice</h3> <p>Using the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Invoices_Refund" target="_blank" rel="noopener noreferrer">invoice refund endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> you can issue a full (or even partial) refund of an invoice. This will return a link where the customer can claim the refund.</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btcpayServerUrl <span class="token operator">=</span> <span class="token string">'https://mainnet.demo.btcpayserver.org'</span>
<span class="token keyword">const</span> storeId <span class="token operator">=</span> <span class="token string">'YOUR_STORE_ID'</span>
<span class="token keyword">const</span> apiKey <span class="token operator">=</span> <span class="token string">'YOUR_API_KEY'</span>
<span class="token keyword">const</span> invoiceId <span class="token operator">=</span> <span class="token string">'EXISTING_INVOICE_ID'</span>

<span class="token keyword">const</span> apiEndpoint <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/v1/stores/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>storeId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/invoices/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>invoiceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/refund</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">'token '</span> <span class="token operator">+</span> apiKey
<span class="token punctuation">}</span>

<span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">refundVariant</span><span class="token operator">:</span> <span class="token string">'CurrentRate'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">paymentMethod</span><span class="token operator">:</span> <span class="token string">'BTC'</span>
<span class="token punctuation">}</span>

<span class="token function">fetch</span><span class="token punctuation">(</span>btcpayServerUrl <span class="token operator">+</span> apiEndpoint<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> headers<span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="btcpay-server-management-examples"><a href="#btcpay-server-management-examples" class="header-anchor">#</a> BTCPay Server management examples</h2> <p>Here we assume you are an ambassador and host BTCPay Server for your users. You manage your users on your own system and want to create a user and set email and password for their BTCPay Server login. Then using the same credentials to create a store and an API key on behalf of that user.</p> <h3 id="create-a-new-user"><a href="#create-a-new-user" class="header-anchor">#</a> Create a new user</h3> <p>Creating a new user can be done by using <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Users_CreateUser" target="_blank" rel="noopener noreferrer">this endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btcpayServerUrl <span class="token operator">=</span> <span class="token string">'https://mainnet.demo.btcpayserver.org'</span>
<span class="token keyword">const</span> adminApiKey <span class="token operator">=</span> <span class="token string">'YOUR_ADMIN_API_KEY'</span>

<span class="token keyword">const</span> apiEndpoint <span class="token operator">=</span> <span class="token string">'/api/v1/users'</span>

<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">'token '</span> <span class="token operator">+</span> adminApiKey
<span class="token punctuation">}</span>

<span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'satoshi.nakamoto@example.com'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'SuperSecurePasswordsShouldBeQuiteLong123'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isAdministrator</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token function">fetch</span><span class="token punctuation">(</span>btcpayServerUrl <span class="token operator">+</span> apiEndpoint<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> headers<span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="create-a-new-api-key-for-the-user"><a href="#create-a-new-api-key-for-the-user" class="header-anchor">#</a> Create a new API key (for the user)</h3> <p>While we can use basic authentication to access the greenfield API, it is recommended to use API Keys to limit the scope of the credentials.</p> <p>For example: If we want to <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Stores_CreateStore" target="_blank" rel="noopener noreferrer">create a new store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> we need the <code>btcpay.store.canmodifystoresettings</code> permission for the API key. Warning: If you do not pass any permission then the API key will have unrestricted access.</p> <p>As mentioned above, you can do this through the BTCPay Server UI of your instance, but let's do it through the API using <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/ApiKeys_CreateUserApiKey" target="_blank" rel="noopener noreferrer">this endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> where we with our admin API key create an API key for our new user.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btcpayServerUrl <span class="token operator">=</span> <span class="token string">'https://mainnet.demo.btcpayserver.org'</span>
<span class="token keyword">const</span> adminApiKey <span class="token operator">=</span> <span class="token string">'YOUR_ADMIN_API_KEY'</span>
<span class="token keyword">const</span> email <span class="token operator">=</span> <span class="token string">'satoshi.nakamoto@example.com'</span>

<span class="token keyword">const</span> apiEndpoint <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/v1/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api-keys</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">'token '</span> <span class="token operator">+</span> adminApiKey
<span class="token punctuation">}</span>

<span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'Satoshi Nakamoto API Key'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">permissions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'btcpay.store.canmodifystoresettings'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token function">fetch</span><span class="token punctuation">(</span>btcpayServerUrl <span class="token operator">+</span> apiEndpoint<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> headers<span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// returns apiKey</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="create-a-new-store"><a href="#create-a-new-store" class="header-anchor">#</a> Create a new store</h3> <p>Now, we can use the api key to <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Stores_CreateStore" target="_blank" rel="noopener noreferrer">create a new store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btcpayserverUrl <span class="token operator">=</span> <span class="token string">'https://mainnet.demo.btcpayserver.org'</span>
<span class="token keyword">const</span> userApiKey <span class="token operator">=</span> <span class="token string">'USER_API_KEY'</span> <span class="token comment">// From previous step</span>

<span class="token keyword">const</span> apiEndpoint <span class="token operator">=</span> <span class="token string">'/api/v1/stores'</span>

<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">'token '</span> <span class="token operator">+</span> userApiKey
<span class="token punctuation">}</span>
<span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Satoshi Store'</span>
<span class="token punctuation">}</span>

<span class="token function">fetch</span><span class="token punctuation">(</span>btcpayServerUrl <span class="token operator">+</span> apiEndpoint<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> headers<span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="read-store-information"><a href="#read-store-information" class="header-anchor">#</a> Read store information</h3> <p>We can use the new apikey to <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Stores_GetStore" target="_blank" rel="noopener noreferrer">read store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> information:</p> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btcpayServerUrl <span class="token operator">=</span> <span class="token string">'https://mainnet.demo.btcpayserver.org'</span>
<span class="token keyword">const</span> userApiKey <span class="token operator">=</span> <span class="token string">'USER_API_KEY'</span> <span class="token comment">// From previous step</span>
<span class="token keyword">const</span> storeId <span class="token operator">=</span> <span class="token string">'STORE_ID'</span> <span class="token comment">// From previous step</span>

<span class="token keyword">const</span> apiEndpoint <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/v1/stores/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>storeId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">'token '</span> <span class="token operator">+</span> userApiKey
<span class="token punctuation">}</span>

<span class="token function">fetch</span><span class="token punctuation">(</span>btcpayServerUrl <span class="token operator">+</span> apiEndpoint<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> headers
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/btcpayserver/btcpayserver-doc/edit/master/docs/Development/GreenFieldExample-NodeJS.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="edit-link"><a href="https://github.com/btcpayserver/btcpayserver-doc/issues/new?title=Improve%20Greenfield%20API%20example%20with%20Node.js%20(JavaScript)&amp;body=I%20could%20not%20find%20the%20information%20I%20was%20looking%20for%20on%20the%20%22Greenfield%20API%20example%20with%20Node.js%20(JavaScript)%22%20page%20(%60%2FDevelopment%2FGreenFieldExample-NodeJS%2F%60).%0A%0A%5BPLEASE%20DESCRIBE%20HOW%20THE%20PAGE%20CAN%20BE%20IMPROVED%5D&amp;labels=question" target="_blank" rel="noopener noreferrer">Didn't find an answer?</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Development/GreenFieldExample/" class="prev">
        Greenfield API example with cURL
      </a></span> <span class="next"><a href="/Development/GreenfieldExample-PHP/">
        Greenfield API examples with PHP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d50c8245.js" defer></script><script src="/assets/js/2.04ab019e.js" defer></script><script src="/assets/js/126.ef170f03.js" defer></script>
  </body>
</html>
