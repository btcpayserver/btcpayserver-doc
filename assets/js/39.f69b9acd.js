(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{605:function(t,e,i){t.exports=i.p+"assets/img/multisig-configuration.da1a4f28.png"},606:function(t,e,i){t.exports=i.p+"assets/img/multisig-email-rule-configure.3c6f1227.png"},607:function(t,e,i){t.exports=i.p+"assets/img/multisig-email-rule-create.8a6af812.png"},608:function(t,e,i){t.exports=i.p+"assets/img/multisig-view.db62b19a.png"},609:function(t,e,i){t.exports=i.p+"assets/img/multisig-choose-method.e6e392ea.png"},610:function(t,e,i){t.exports=i.p+"assets/img/multisig-signed-1.5fae43a1.png"},611:function(t,e,i){t.exports=i.p+"assets/img/multisig-broadcast.afb224ee.png"},612:function(t,e,i){t.exports=i.p+"assets/img/multisig-broadcast-2.12f2b998.png"},996:function(t,e,i){"use strict";i.r(e);var a=i(17),r=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"multisig-support-in-btcpay-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#multisig-support-in-btcpay-server"}},[t._v("#")]),t._v(" MultiSig support in BTCPay Server")]),t._v(" "),e("p",[t._v("BTCPay Server v2.1.0 introduced refined support for multi signature (multisig) wallets designed to empower your setup with added security, collaboration, and flexibility.")]),t._v(" "),e("p",[t._v("This document provides step-by-step instructions for configuring and utilizing multisig wallets within your BTCPay Server instance.")]),t._v(" "),e("a",{staticClass:"ytEmbed",staticStyle:{"background-image":"url(https://img.youtube.com/vi/V95pLvVTAqM/hqdefault.jpg)"},attrs:{href:"https://www.youtube.com/watch?v=V95pLvVTAqM",title:"Refined Multi-Sig in BTCPay Server using XPUB Extractor","data-id":"V95pLvVTAqM"}},[e("iframe",{attrs:{title:"Refined Multi-Sig in BTCPay Server using XPUB Extractor","data-src":"https://www.youtube-nocookie.com/embed/V95pLvVTAqM?&autoplay=1&autohide=1&modestbranding=1&color=white&rel=0",frameborder:"0",allow:"autoplay;encrypted-media;picture-in-picture",allowfullscreen:""}})]),t._v(" "),e("h2",{attrs:{id:"overview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[t._v("#")]),t._v(" Overview")]),t._v(" "),e("p",[t._v("Multisig functionality in BTCPay Server enables:")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("Collaborative custody")]),t._v(": Create a wallet that requires multiple signatures to authorize broadcast a transaction.")]),t._v(" "),e("li",[e("strong",[t._v("Self-hosted multisig coordination")]),t._v(": Shared control of company’s public keys and signing flow without relying on a third-party.")]),t._v(" "),e("li",[e("strong",[t._v("Hardware wallet support")]),t._v(": Works seamlessly with the BTCPay Vault and is compatible with majority hardware signing devices allowing you to authorize a transaction with a hardware wallet.")]),t._v(" "),e("li",[e("strong",[t._v("Notification system")]),t._v(": Stay informed with email alerts when transactions are created, pending, (requiring sufficient amount of signatures), and broadcasted.")]),t._v(" "),e("li",[e("strong",[t._v("Integration with plugins")]),t._v(": Works with Vendor Pay and future features, enabling multisig-based payouts. Integrates with Xpub Extractor, allowing all multisig participants to easily get appropriate format")])]),t._v(" "),e("h2",{attrs:{id:"prerequisites"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),e("p",[t._v("Ensure the following components are installed and configured:")]),t._v(" "),e("ul",[e("li",[t._v("BTCPay Server instance (v2.1 or later)")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/btcpayserver/BTCPayServer.Vault",target:"_blank",rel:"noopener noreferrer"}},[t._v("BTCPay Vault"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/btcpayserver/BTCPayServer.Plugins.XpubExtractor",target:"_blank",rel:"noopener noreferrer"}},[t._v("XpubExtractor Plugin"),e("OutboundLink")],1),t._v(" (if you're setting up hardware wallet)")])]),t._v(" "),e("h2",{attrs:{id:"step-1-collect-extended-public-keys"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-1-collect-extended-public-keys"}},[t._v("#")]),t._v(" Step 1: Collect Extended Public Keys")]),t._v(" "),e("p",[t._v("The following explains how to get required public key from the "),e("RouterLink",{attrs:{to:"/HardwareWalletIntegration/"}},[t._v("hardware wallet")]),t._v(". If you're using software wallet, you can proceed to step 2.")],1),t._v(" "),e("ol",[e("li",[t._v("Navigate to "),e("code",[t._v("Manage Plugins")]),t._v(" and confirm that "),e("strong",[t._v("XpubExtractor")]),t._v(" is installed and published by "),e("em",[t._v("RockstarDev")]),t._v(".")]),t._v(" "),e("li",[t._v("Connect the hardware wallet and launch "),e("a",{attrs:{href:"http://docs.btcpayserver.org/HardwareWalletIntegration/",target:"_blank",rel:"noopener noreferrer"}},[t._v("BTCPay Vault"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("li",[t._v("Use the "),e("code",[t._v("Fetch Xpub")]),t._v(" function to retrieve:\n"),e("ul",[e("li",[t._v("Extended public key (xpub)")]),t._v(" "),e("li",[t._v("Root fingerprint")]),t._v(" "),e("li",[t._v("Derivation path")])])]),t._v(" "),e("li",[t._v("Save data for the wallet.")])]),t._v(" "),e("p",[t._v("Example value:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("xpub6CUGRUonZSQ4TWtTMmzXdrXDtypWKiKp5KUMRmD9YgoWDbEVpLFgje71pRAVBPX6DCmV9HNTLr8GHqKZANvNcFpSZe3kiKsH5Ej7ApG1NVDK\nRoot Fingerprint: abcdef21\nKey Path: 48'/0'/0'/0'\n")])])]),e("h3",{attrs:{id:"inviting-additional-signers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#inviting-additional-signers"}},[t._v("#")]),t._v(" Inviting Additional Signers")]),t._v(" "),e("ol",[e("li",[t._v("Go to "),e("code",[t._v("Settings")]),t._v(" > "),e("code",[t._v("Users")]),t._v(".")]),t._v(" "),e("li",[t._v("Add each participant’s email address and share the generated invite link with them directly. If you have Email SMTP in your server, they'll receive an invite email.")]),t._v(" "),e("li",[t._v("Instruct participants to:\n"),e("ul",[e("li",[t._v("Accept the invitation")]),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/CreateStore/"}},[t._v("Create a BTCPay Server Store")])],1),t._v(" "),e("li",[t._v("Use "),e("a",{attrs:{href:"https://github.com/rockstardev/BTCPayServerPlugins.RockstarDev/tree/1235799827c24d33bfe1095db5169afd39e620f1/Plugins/BTCPayServer.RockstarDev.Plugins.XpubExtractor",target:"_blank",rel:"noopener noreferrer"}},[t._v("XpubExtractor"),e("OutboundLink")],1),t._v(" to provide their xpub information")])])]),t._v(" "),e("li",[t._v("They should save data for their wallets and share them with you.")])]),t._v(" "),e("p",[t._v("Please note that, for now, you must invite users as Store "),e("code",[t._v("Owners")]),t._v(". We plan to implement additional roles and permissions in the future to reduce the trust factor for those you invite to the multisig store. You can "),e("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver/issues/6651",target:"_blank",rel:"noopener noreferrer"}},[t._v("track the status of this implementation on GitHub"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("h2",{attrs:{id:"step-2-create-the-multi-signature-wallet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-2-create-the-multi-signature-wallet"}},[t._v("#")]),t._v(" Step 2: Create the Multi-signature Wallet")]),t._v(" "),e("p",[t._v("After collecting all required public keys, (e.g., 2-of-3 setup), proceed as follows:")]),t._v(" "),e("ol",[e("li",[t._v("Go to "),e("code",[t._v("Bitcoin Wallets")]),t._v(".")]),t._v(" "),e("li",[t._v("Select "),e("code",[t._v("Connect an existing wallet")]),t._v(" > "),e("code",[t._v("Enter extended public key")]),t._v(".")]),t._v(" "),e("li",[t._v("Choose "),e("code",[t._v("Show multisig examples")]),t._v(" and input the collected xpubs in the required format.")]),t._v(" "),e("li",[t._v("Click "),e("code",[t._v("Continue")]),t._v(" to validate and preview the derived addresses. You can validate the preview via external software wallet, or simply by testing in the final step of this document.")])]),t._v(" "),e("p",[t._v("An example of your multisig could look like this:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("2-of-xpub6BosLW1vGZLkCW7NrgUQdREa7i3a7XJXnAMQzA3aJCEuEt8hXNRu2yG6Vxq2YvCCu8n2eUpZhVz5Zw3eQro2d5Wq8UdD2qhM1YG4ZcnC3kYd-xpub6FHVXph13QMR77fUMLREpN2L7D1fCqcVtzsGhM28jUy5CWTpYHDuN6gvN5Gi5rxJjL45AgXLhSzE27AHZkDwKZgTYaUmYc9rBoF2tuAgf6M-xpub6CJ61yVNhtEtcpS7pU8Jjpd1NHgAG6xWv1NG4b47SvhhVVqfzFrHdcDUpm96B2ftov3qd5uoy6b7bEVcdxQwK6R7T5ndJP8vTWTdS6RBn7Jr\n")])])]),e("p",[t._v("This means 2 out of 3 listed signatures are required to authorize a transaction. You can as well put 3 out of 5, and so on.")]),t._v(" "),e("p",[t._v("Next, adjust wallet settings to ensure proper compatibility with various formats and easier signing.")]),t._v(" "),e("ol",[e("li",[t._v("Navigate to "),e("code",[t._v("Wallet Settings")]),t._v(".")]),t._v(" "),e("li",[t._v("Enable the "),e("code",[t._v("Multisig on Server")]),t._v(" option.")]),t._v(" "),e("li",[t._v("Input the "),e("code",[t._v("root fingerprint")]),t._v(" and "),e("code",[t._v("derivation path")]),t._v(" for each key.")]),t._v(" "),e("li",[t._v("Enable "),e("code",[t._v("Include non-witness UTXO in PSBTs")]),t._v(" for enhanced compatibility.")]),t._v(" "),e("li",[e("code",[t._v("Save")]),t._v(" changes.")])]),t._v(" "),e("figure",[e("img",{attrs:{src:i(605),alt:""}})]),t._v(" "),e("h3",{attrs:{id:"optional-testing-the-receive-funds-setup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#optional-testing-the-receive-funds-setup"}},[t._v("#")]),t._v(" (Optional) Testing the receive funds setup")]),t._v(" "),e("ol",[e("li",[t._v("From the main multisig store, in the sidebar, click "),e("code",[t._v("Bitcoin > Receive")])]),t._v(" "),e("li",[t._v('Label the address (e.g. "Test")')]),t._v(" "),e("li",[t._v("Send a small amount of Bitcoin to verify the setup")]),t._v(" "),e("li",[t._v("Optionally you can import the multisig into a different software to verify receiving works.")])]),t._v(" "),e("h2",{attrs:{id:"3-configure-email-notifications"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#3-configure-email-notifications"}},[t._v("#")]),t._v(" 3. Configure email notifications")]),t._v(" "),e("p",[t._v("This step ensures all participants receive email when the new transaction is created, requires their signature and finally broadcasted successfully.")]),t._v(" "),e("p",[t._v("For participants to receive updates on multisig activity, you have to set up "),e("RouterLink",{attrs:{to:"/Notifications/#email-rules"}},[t._v("custom email-rules")]),t._v(".")],1),t._v(" "),e("figure",[e("img",{attrs:{src:i(606),alt:""}})]),t._v(" "),e("figure",[e("img",{attrs:{src:i(607),alt:""}})]),t._v(" "),e("ol",[e("li",[t._v("Go to "),e("code",[t._v("Store Settings > Emails > Email Rules")])]),t._v(" "),e("li",[t._v("Click on "),e("code",[t._v("Configure")]),t._v(" and then "),e("code",[t._v("Create")])]),t._v(" "),e("li",[t._v("From the "),e("code",[t._v("Trigger")]),t._v(" dropdown, select "),e("code",[t._v("Pending Transaction Created")]),t._v(" and add email addresses of multisig participants, separated by a comma: "),e("code",[t._v("email1@test.com, email2@test.com, email3@test.com")])]),t._v(" "),e("li",[t._v("Feel free to modify the default Body and Text to your liking.")]),t._v(" "),e("li",[t._v("When you're done, click "),e("code",[t._v("Save")])])]),t._v(" "),e("p",[t._v("Repeat the steps 3 to 5 for two more triggers: "),e("code",[t._v("Signature Collected")]),t._v(" and "),e("code",[t._v("Transaction Broadcasted")])]),t._v(" "),e("h2",{attrs:{id:"step-4-send-a-transaction-from-the-multisig-wallet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-4-send-a-transaction-from-the-multisig-wallet"}},[t._v("#")]),t._v(" Step 4: Send a transaction from the multisig wallet")]),t._v(" "),e("ol",[e("li",[t._v("Go to your multisig wallet")]),t._v(" "),e("li",[t._v("Enter recipient address and amount")]),t._v(" "),e("li",[t._v("Click "),e("code",[t._v("Create Pending Transaction")])]),t._v(" "),e("li",[t._v("Participants will now receive an email if you followed the Step 3, prompting them to sign a transaction with their wallet.")])]),t._v(" "),e("h2",{attrs:{id:"step-5-signing-a-multi-sig-transaction"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-5-signing-a-multi-sig-transaction"}},[t._v("#")]),t._v(" Step 5. Signing a multi-sig transaction:")]),t._v(" "),e("p",[t._v("Now that transaction has been created, participants would have to sign(authorize it) with their hardware wallet.")]),t._v(" "),e("ol",[e("li",[t._v("In wallet transaction list of the main multi-signature store, participant will see a pending transaction.")]),t._v(" "),e("li",[t._v("Click on "),e("code",[t._v("View")])]),t._v(" "),e("li",[t._v("If you're signing with a hardware wallet, connect your hardware wallet and ensure "),e("code",[t._v("BTCPay Vault")]),t._v(" is running")]),t._v(" "),e("li",[t._v("Click "),e("code",[t._v("Sign")])]),t._v(" "),e("li",[t._v("Follow on-screen and device prompts to "),e("code",[t._v("sign the transaction")])])]),t._v(" "),e("figure",[e("img",{attrs:{src:i(608),alt:""}})]),t._v(" "),e("figure",[e("img",{attrs:{src:i(609),alt:""}})]),t._v(" "),e("figure",[e("img",{attrs:{src:i(610),alt:""}})]),t._v(" "),e("p",[t._v("Other participants should follow the same steps.  Once the required number of signatures is collected, click Broadcast to send the transaction.")]),t._v(" "),e("figure",[e("img",{attrs:{src:i(611),alt:""}})]),t._v(" "),e("figure",[e("img",{attrs:{src:i(612),alt:""}})]),t._v(" "),e("p",[t._v("Congratulations! You’ve sent your first multisig transaction using BTCPay Server.")])])}),[],!1,null,null,null);e.default=r.exports}}]);