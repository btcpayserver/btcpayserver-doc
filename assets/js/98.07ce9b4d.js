(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{740:function(t,e,a){"use strict";a.r(e);var s=a(35),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"deployment-faq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment-faq"}},[t._v("#")]),t._v(" Deployment FAQ")]),t._v(" "),a("p",[t._v("This document covers the most common questions, errors, and issues you may encounter prior and during the installation of the software. For a detailed list of deployment methods and instructions for each, please see "),a("RouterLink",{attrs:{to:"/Deployment/"}},[t._v("Deployment page")]),t._v(".")],1),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#general-deployment"}},[t._v("General Deployment")]),a("ul",[a("li",[a("a",{attrs:{href:"#how-much-does-it-cost-to-run-btcpay-server"}},[t._v("How much does it cost to run BTCPay Server?")])]),a("li",[a("a",{attrs:{href:"#what-are-the-minimal-requirements-for-btcpay"}},[t._v("What are the minimal requirements for BTCPay?")])]),a("li",[a("a",{attrs:{href:"#what-is-the-easiest-method-to-deploy-a-self-hosted-btcpay-server"}},[t._v("What is the easiest method to deploy a self-hosted BTCPay Server?")])]),a("li",[a("a",{attrs:{href:"#how-to-choose-a-proper-deployment-method"}},[t._v("How to choose a proper deployment method?")])]),a("li",[a("a",{attrs:{href:"#can-i-run-btcpay-on-my-own-hardware"}},[t._v("Can I run BTCPay on my own hardware?")])]),a("li",[a("a",{attrs:{href:"#can-i-deploy-btcpay-on-my-existing-vps"}},[t._v("Can I deploy BTCPay on my existing VPS?")])]),a("li",[a("a",{attrs:{href:"#are-there-free-hosts-where-i-can-test"}},[t._v("Are there free hosts where I can test?")])]),a("li",[a("a",{attrs:{href:"#after-initial-deployment-i-cant-register-and-i-dont-have-a-login-yet"}},[t._v("After initial deployment, I can't register and I don't have a login yet?")])]),a("li",[a("a",{attrs:{href:"#how-do-i-activate-tor-on-my-btcpay-server"}},[t._v("How do I activate Tor on my BTCPay Server?")])]),a("li",[a("a",{attrs:{href:"#how-do-i-disable-tor-on-my-btcpay-server"}},[t._v("How do I disable Tor on my BTCPay Server?")])]),a("li",[a("a",{attrs:{href:"#why-activate-tor-does-it-mean-that-nobody-knows-who-i-am"}},[t._v("Why activate Tor? Does it mean that nobody knows who I am?")])]),a("li",[a("a",{attrs:{href:"#how-to-access-the-onion-address-without-clearnet"}},[t._v("How to access the .onion address without clearnet?")])]),a("li",[a("a",{attrs:{href:"#how-can-i-modify-or-deactivate-environment-variables"}},[t._v("How can I modify or deactivate environment variables?")])]),a("li",[a("a",{attrs:{href:"#how-can-i-run-btcpay-on-testnet"}},[t._v("How can I run BTCPay on testnet?")])]),a("li",[a("a",{attrs:{href:"#can-i-start-btcpay-only-when-im-expecting-a-payment"}},[t._v("Can I start BTCPay only when I'm expecting a payment?")])]),a("li",[a("a",{attrs:{href:"#can-i-connect-to-my-btcpay-bitcoin-p2p-on-port-8333"}},[t._v("Can I connect to my BTCPay Bitcoin P2P on port 8333?")])]),a("li",[a("a",{attrs:{href:"#how-can-i-renew-my-ssl-certificate"}},[t._v("How can I renew my SSL certificate?")])]),a("li",[a("a",{attrs:{href:"#can-i-use-an-existing-nginx-server-as-a-reverse-proxy-with-ssl-termination"}},[t._v("Can I use an existing Nginx server as a reverse proxy with SSL termination?")])])])]),a("li",[a("a",{attrs:{href:"#web-deployment"}},[t._v("Web-deployment")]),a("ul",[a("li",[a("a",{attrs:{href:"#can-i-run-btcpay-on-my-home-computer"}},[t._v("Can I run BTCPay on my home computer?")])]),a("li",[a("a",{attrs:{href:"#lunanode-web-deployment"}},[t._v("LunaNode web-deployment")])])])]),a("li",[a("a",{attrs:{href:"#manual-deployment"}},[t._v("Manual Deployment")]),a("ul",[a("li",[a("a",{attrs:{href:"#how-do-i-completely-uninstall-btcpay-from-a-linux-environment-docker-version"}},[t._v("How do I completely uninstall BTCPay from a linux environment (docker version)")])]),a("li",[a("a",{attrs:{href:"#how-to-deploy-btcpay-server-alongside-existing-bitcoin-node"}},[t._v("How to deploy BTCPay Server alongside existing Bitcoin node?")])]),a("li",[a("a",{attrs:{href:"#with-the-docker-deployment-how-to-use-a-different-volume-for-the-data"}},[t._v("With the docker deployment, how to use a different volume for the data?")])]),a("li",[a("a",{attrs:{href:"#i-get-503-service-temporarily-unavailable-nginx"}},[t._v("I get 503 Service Temporarily Unavailable nginx")])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"general-deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#general-deployment"}},[t._v("#")]),t._v(" General Deployment")]),t._v(" "),a("h3",{attrs:{id:"how-much-does-it-cost-to-run-btcpay-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-much-does-it-cost-to-run-btcpay-server"}},[t._v("#")]),t._v(" How much does it cost to run BTCPay Server?")]),t._v(" "),a("p",[t._v("BTCPay is a 100% free and open-source software. We do not charge you anything.\nHowever, to run it, you should host it. You can run it as a self-hosted solution on your own local server, or use a cloud hosting provider, which is what a majority of users do. Advanced users can run BTCPay on "),a("RouterLink",{attrs:{to:"/Deployment/Hardware/"}},[t._v("their own hardware")]),t._v(". Less technical users can use "),a("RouterLink",{attrs:{to:"/Deployment/HardwareAsAService/"}},[t._v("Hardware As A Service options")]),t._v(". If you do not wish to host your own server, you can use a free "),a("RouterLink",{attrs:{to:"/Deployment/ThirdPartyHosting/"}},[t._v("Third-Party Host")]),t._v(". Visit our "),a("RouterLink",{attrs:{to:"/Deployment/"}},[t._v("Deployment Page")]),t._v(" for more information on the various ways in which you can run BTCPay.")],1),t._v(" "),a("h3",{attrs:{id:"what-are-the-minimal-requirements-for-btcpay"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-are-the-minimal-requirements-for-btcpay"}},[t._v("#")]),t._v(" What are the minimal requirements for BTCPay?")]),t._v(" "),a("p",[t._v("If you would like to run Bitcoin and Lightning Network nodes, the minimal requirements are :")]),t._v(" "),a("ul",[a("li",[t._v("2GB Ram")]),t._v(" "),a("li",[t._v("80 GB of storage "),a("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[t._v("with enabled pruning")])],1),t._v(" "),a("li",[t._v("Docker")])]),t._v(" "),a("h3",{attrs:{id:"what-is-the-easiest-method-to-deploy-a-self-hosted-btcpay-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-the-easiest-method-to-deploy-a-self-hosted-btcpay-server"}},[t._v("#")]),t._v(" What is the easiest method to deploy a self-hosted BTCPay Server?")]),t._v(" "),a("p",[t._v("For beginners, we strongly recommend the "),a("RouterLink",{attrs:{to:"/Deployment/LunaNode/"}},[t._v("web-deployment")]),t._v(" if you want a self-hosted solution or a "),a("RouterLink",{attrs:{to:"/Deployment/ThirdPartyHosting/"}},[t._v("third-party host")]),t._v(".")],1),t._v(" "),a("p",[t._v("If you're going to add more than one crypto coin, you need to expand the storage according to that coin(s) blockchain size.")]),t._v(" "),a("h3",{attrs:{id:"how-to-choose-a-proper-deployment-method"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-choose-a-proper-deployment-method"}},[t._v("#")]),t._v(" How to choose a proper deployment method?")]),t._v(" "),a("p",[t._v("Please see the "),a("RouterLink",{attrs:{to:"/Deployment/"}},[t._v("Deployment page")]),t._v(" for comparison of different installation methods and choose the one that suits your needs and skill level the most.")],1),t._v(" "),a("h3",{attrs:{id:"can-i-run-btcpay-on-my-own-hardware"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#can-i-run-btcpay-on-my-own-hardware"}},[t._v("#")]),t._v(" Can I run BTCPay on my own hardware?")]),t._v(" "),a("p",[t._v("Yes, you can. Check our the "),a("RouterLink",{attrs:{to:"/Deployment/Hardware/"}},[t._v("Hardware Deployment page")]),t._v(" for detailed instructions.")],1),t._v(" "),a("h3",{attrs:{id:"can-i-deploy-btcpay-on-my-existing-vps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#can-i-deploy-btcpay-on-my-existing-vps"}},[t._v("#")]),t._v(" Can I deploy BTCPay on my existing VPS?")]),t._v(" "),a("p",[t._v("Yes. BTCPay is not limited to the documented deployment methods. You can use whichever hosting solution you prefer, that fits the minimal requirements.")]),t._v(" "),a("h3",{attrs:{id:"are-there-free-hosts-where-i-can-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#are-there-free-hosts-where-i-can-test"}},[t._v("#")]),t._v(" Are there free hosts where I can test?")]),t._v(" "),a("p",[t._v("On a self-hosted BTCPay, an unlimited amount of users and stores can be attached. Some community users have open registration on their servers for others to use their BTCPay Server mainly for testing and learning. Most of them are community-driven and free. See the "),a("RouterLink",{attrs:{to:"/Deployment/ThirdPartyHosting/"}},[t._v("third-party hosts documentation")]),t._v(" for more information.")],1),t._v(" "),a("h3",{attrs:{id:"after-initial-deployment-i-cant-register-and-i-dont-have-a-login-yet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#after-initial-deployment-i-cant-register-and-i-dont-have-a-login-yet"}},[t._v("#")]),t._v(" After initial deployment, I can't register and I don't have a login yet?")]),t._v(" "),a("p",[t._v("When you deploy your BTCPay Server, you should first register a user (during server synchronization). This user is automatically the server admin. If your BTCPay only shows Login in the header menu, and you are unable to register the first user after initial deployment, someone else has registered on your server as the admin. Although this is unlikely to occur (the user would need to know and watch your BTCPay domain name), they had access to your ssh private keys, thus you should redeploy a new server for security reasons.")]),t._v(" "),a("h3",{attrs:{id:"how-do-i-activate-tor-on-my-btcpay-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-do-i-activate-tor-on-my-btcpay-server"}},[t._v("#")]),t._v(" How do I activate Tor on my BTCPay Server?")]),t._v(" "),a("p",[t._v("Tor is activated by default on the docker deployment.")]),t._v(" "),a("h3",{attrs:{id:"how-do-i-disable-tor-on-my-btcpay-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-do-i-disable-tor-on-my-btcpay-server"}},[t._v("#")]),t._v(" How do I disable Tor on my BTCPay Server?")]),t._v(" "),a("p",[t._v("That's really easy: just log in your instance with SSH, and enter as root the enter following commands:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_EXCLUDE_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_EXCLUDE_FRAGMENTS")]),t._v(';opt-add-tor"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh -i\n")])])]),a("p",[t._v("Then wait a few minutes for the server to restart, and you're done!")]),t._v(" "),a("h3",{attrs:{id:"why-activate-tor-does-it-mean-that-nobody-knows-who-i-am"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#why-activate-tor-does-it-mean-that-nobody-knows-who-i-am"}},[t._v("#")]),t._v(" Why activate Tor? Does it mean that nobody knows who I am?")]),t._v(" "),a("p",[t._v("Tor for BTCPay server is intended more as an improvement of the setup process, and allows for more flexibility for hosting on one's own device at home or in an office.")]),t._v(" "),a("p",[t._v("Having Tor activated would allow for simpler, plug-and-play usage of BTCPay, as it suppress the need for the following configuration steps:")]),t._v(" "),a("ul",[a("li",[t._v("Opening multiple ports on the firewall")]),t._v(" "),a("li",[t._v("Configuring the NAT for port redirection to your device on your local network")]),t._v(" "),a("li",[t._v("Setting up a DNS entry to get a HTTPS certificate")]),t._v(" "),a("li",[t._v("Having a fixed IP for Lightning")])]),t._v(" "),a("p",[t._v("While these steps are usually not a problem when BTCPay is hosted on a VPS, it can be difficult to solve for non-technical users on home or office networks.")]),t._v(" "),a("p",[t._v("Tor just solves all these issues in one shot, all you have to do is plug your device on the local network. It is especially useful for POS application.")]),t._v(" "),a("p",[t._v("But if you're looking for perfect privacy and security, "),a("strong",[t._v("activating Tor with your BTCPay just won't do it.")])]),t._v(" "),a("p",[t._v("Tor is a really tricky software to use for developers, as the slightest mistake can tear down the anonymity it provides. As BTCPay is evolving into a rather complex service and adding more and more plugins, even if we tried to route all this traffic through Tor, we couldn't guarantee that there would never be leaks of data in clear.")]),t._v(" "),a("p",[t._v("We think that the illusion of security is more dangerous that no security, or at least security we know is imperfect. So be aware that activating Tor doesn't prevent others to connect to your instance website, your bitcoin or lightning node in clear, "),a("strong",[t._v("it doesn't make you anonymous at all.")])]),t._v(" "),a("p",[t._v("If you want to know more about the philosophy behind all this, you can read our "),a("a",{attrs:{href:"https://medium.com/@BtcpayServer/about-tor-and-btcpay-server-2ec1e4bd5e51",target:"_blank",rel:"noopener noreferrer"}},[t._v("article on  Medium"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"how-to-access-the-onion-address-without-clearnet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-access-the-onion-address-without-clearnet"}},[t._v("#")]),t._v(" How to access the .onion address without clearnet?")]),t._v(" "),a("p",[t._v("To see the .onion address of your BTCPay instance without accessing it through the clearnet and clicking the Tor logo in top left corner, apply the following command:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/lib/docker/volumes/generated_tor_servicesdir/_data/BTCPayServer/hostname\n")])])]),a("h3",{attrs:{id:"how-can-i-modify-or-deactivate-environment-variables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-can-i-modify-or-deactivate-environment-variables"}},[t._v("#")]),t._v(" How can I modify or deactivate environment variables?")]),t._v(" "),a("p",[t._v("In BTCPay, various options are activated through environment variables. You can modify or delete any of these options using command lines by exporting the new value with "),a("code",[t._v('export {environment variable}="{value}"')]),t._v(" and then running "),a("code",[t._v(". ./btcpay-setup.sh -i")]),t._v(" again.")]),t._v(" "),a("p",[t._v("For example, let's say I want to deactivate Tor for my BTCPay server:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Login as root")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" -\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Go to the root/btcpayserver-docker directory")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/btcpayserver-docker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Print the complete list of options that you are running (for the sake of the demonstration, let's say that besides Tor you have pruning mode activated too)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t._v("\nopt-save-storage-s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("opt-add-tor\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Export the BTCPAYGEN_ADDITIONAL_FRAGMENTS variable without opt-add-tor")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"opt-save-storage-s"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run btcpay-setup.sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh -i\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n")])])]),a("p",[t._v("Similarly if you are adding an environment variable, the export command would instead look like this:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Enable Tor in addition to your existing environment variables (such as pruning)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_ADDITIONAL_FRAGMENTS")]),t._v(';opt-add-tor"')]),t._v("\n")])])]),a("p",[t._v("If you need to figure out which environment variable you need to modify, have a look at "),a("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker#environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("this list"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"how-can-i-run-btcpay-on-testnet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-can-i-run-btcpay-on-testnet"}},[t._v("#")]),t._v(" How can I run BTCPay on testnet?")]),t._v(" "),a("p",[t._v("Building on the section above, this is how you configure BTCPay to use "),a("code",[t._v("testnet")]),t._v(" instead of the default "),a("code",[t._v("mainnet")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Export the NBITCOIN_NETWORK variable switching to testnet")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NBITCOIN_NETWORK")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testnet"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run btcpay-setup.sh for the change to take effect")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh -i\n")])])]),a("p",[t._v("If you just want to test things quickly without deploying everything yourself, have a look at the "),a("RouterLink",{attrs:{to:"/TryItOut/"}},[t._v("Try It Out")]),t._v(" section.\nIt provides links and explanations for a BTCPay testnet instance hosted by us.")],1),t._v(" "),a("h3",{attrs:{id:"can-i-start-btcpay-only-when-im-expecting-a-payment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#can-i-start-btcpay-only-when-im-expecting-a-payment"}},[t._v("#")]),t._v(" Can I start BTCPay only when I'm expecting a payment?")]),t._v(" "),a("p",[t._v("No, you need to keep your BTCPay running at all times so that your Bitcoin node stays in sync with the blockchain to verify transactions. If you only start it up every now and then, it would take a long time to catch up on verifying recent blocks, and your payments would not show up until much later.")]),t._v(" "),a("h3",{attrs:{id:"can-i-connect-to-my-btcpay-bitcoin-p2p-on-port-8333"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#can-i-connect-to-my-btcpay-bitcoin-p2p-on-port-8333"}},[t._v("#")]),t._v(" Can I connect to my BTCPay Bitcoin P2P on port 8333?")]),t._v(" "),a("p",[t._v("BTCPay's Bitcoin core node is not exposed externally by default. For BTCPay purposes, it is typically not in the interest of the user, as it increases the bandwidth requirement. BTCPay is also whitebinding connections to this port, so opening it would expose the node to potential DDoS.")]),t._v(" "),a("p",[t._v("However, we expose a P2P connection to your full node on Tor. You can get the Tor address by running:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/lib/docker/volumes/generated_tor_servicesdir/_data/BTC-P2P/hostname\n")])])]),a("p",[t._v("Or via the "),a("code",[t._v("Server Settings")]),t._v(" of your BTCPay Server instance, logged as an administrator.")]),t._v(" "),a("p",[t._v("Please do not share this tor hidden service with untrusted parties. Connections to this hidden service are whitelisted by the bitcoin node, malicious peer would be able to DDoS your node.")]),t._v(" "),a("p",[t._v("If you need to unsafely expose bitcoind P2P port 8333 (for example if you require P2P for Bisq, DOJO, Esplora, etc.) and you are using a docker deployment, you can use the "),a("RouterLink",{attrs:{to:"/Docker/#generated-docker-compose"}},[t._v("opt-unsafe-expose")]),t._v(" additional fragment.")],1),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("ONLY USE ON TRUSTED LAN OR WITH FIREWALL RULES WHITELISTING SPECIFIC HOSTS")])]),t._v(" "),a("h3",{attrs:{id:"how-can-i-renew-my-ssl-certificate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-can-i-renew-my-ssl-certificate"}},[t._v("#")]),t._v(" How can I renew my SSL certificate?")]),t._v(" "),a("p",[t._v("If your SSL certificate has expired for your BTCPay Server, you can manually renew it. For Docker deployments the easiest way to do this is to "),a("RouterLink",{attrs:{to:"/Troubleshooting/#1-3-restarting-a-service"}},[t._v("restart the container")]),t._v(" named "),a("code",[t._v("letsencrypt-nginx-proxy-companion")]),t._v(" on your server.")],1),t._v(" "),a("h3",{attrs:{id:"can-i-use-an-existing-nginx-server-as-a-reverse-proxy-with-ssl-termination"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#can-i-use-an-existing-nginx-server-as-a-reverse-proxy-with-ssl-termination"}},[t._v("#")]),t._v(" Can I use an existing Nginx server as a reverse proxy with SSL termination?")]),t._v(" "),a("p",[t._v("Yes you can! Just make sure to use the proper configuration.")]),t._v(" "),a("p",[t._v("Create an extra config file for your vhost in "),a("code",[t._v("/etc/nginx/sites-available/btcpayserver")]),t._v(" and create a symlink for this file at "),a("code",[t._v("/etc/nginx/sites-enabled/btcpayserver")])]),t._v(" "),a("p",[t._v("The contents of this vhost file should look like this:")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /var/www/html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html index.htm index.nginx-debian.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Put your domain name here")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" btcpay.domain.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Needed for Let's Encrypt verification")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ /.well-known")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("allow")]),t._v(" all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Force HTTP to HTTPS")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl http2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SSL certificate by Let's Encrypt in this Nginx (not using Let's Encyrpt that came with BTCPay Server Docker)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate")]),t._v("      /etc/letsencrypt/live/btcpay.domain.com/fullchain.pem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ssl_certificate_key")]),t._v("  /etc/letsencrypt/live/btcpay.domain.com/privkey.pem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /var/www/html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html index.htm index.nginx-debian.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Put your domain name here")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" btcpay.domain.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Route everything to the real BTCPay server")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# URL of BTCPay Server (i.e. a Docker installation with REVERSEPROXY_HTTP_PORT set to 10080)")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://127.0.0.1:10080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$scheme")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# For websockets (used by Ledger hardware wallets)")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Upgrade "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_upgrade")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Needed for Let's Encrypt verification")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ /.well-known")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("allow")]),t._v(" all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("Also, put the following in your main Nginx config file at "),a("code",[t._v("/etc/nginx/nginx.conf")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ... # Existing stuff")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Needed to allow very long URLs to prevent issues while signing PSBTs")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_names_hash_bucket_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffer_size")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffers")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_busy_buffers_size")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_header_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("large_client_header_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http2_max_field_size")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http2_max_header_size")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Needed websocket support (used by Ledger hardware wallets)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_upgrade")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$connection_upgrade")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" upgrade")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t''      "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("close")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Now test your Nginx config with "),a("code",[t._v("service nginx configtest")]),t._v(" and reload the config with "),a("code",[t._v("service nginx reload")]),t._v(".")]),t._v(" "),a("p",[t._v("Then, you need to make sure that BTCPayServer does not try to handle HTTPS on its side, you can do this by disabling it on your BTCPayServer instance.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BTCPAYGEN_EXCLUDE_FRAGMENTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAYGEN_EXCLUDE_FRAGMENTS")]),t._v(';nginx-https"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh -i\n")])])]),a("p",[t._v("Notice: If your BTCPay Server install has more than one domain (for example "),a("code",[t._v("WOOCOMMERCE_HOST")]),t._v(" or "),a("code",[t._v("BTCPAY_ADDITIONAL_HOSTS")]),t._v(") you will need to modify your config for each domain name. The example above only covers 1 domain name called "),a("code",[t._v("btcpay.domain.com")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"web-deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-deployment"}},[t._v("#")]),t._v(" Web-deployment")]),t._v(" "),a("p",[t._v("Here you can find common questions and solutions to BTCPay web-deployments.")]),t._v(" "),a("h3",{attrs:{id:"can-i-run-btcpay-on-my-home-computer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#can-i-run-btcpay-on-my-home-computer"}},[t._v("#")]),t._v(" Can I run BTCPay on my home computer?")]),t._v(" "),a("p",[t._v("Similar to the requirements for hosting a website, a web server is required for a BTCPay Server instance. While it is possible to run BTCPay Server locally on your PC, it would have to meet the minimal requirements and also run 24/7 if you don't want interruptions of service. You might also not want to expose your home IP address for the activity related to BTCPay Server payments. For all these reasons, while local hosting is suitable for testing, it's not a viable solution for production. A Virtual Private Server (VPS) is commonly used to address these problems.")]),t._v(" "),a("h3",{attrs:{id:"lunanode-web-deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lunanode-web-deployment"}},[t._v("#")]),t._v(" LunaNode web-deployment")]),t._v(" "),a("h4",{attrs:{id:"how-to-change-domain-name-on-my-lunanode-btcpay"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-change-domain-name-on-my-lunanode-btcpay"}},[t._v("#")]),t._v(" How to change domain name on my LunaNode BTCPay?")]),t._v(" "),a("ol",[a("li",[t._v("In your LunaNode dashboard, click on Virtual Machines > Your Virtual Machine > General Tab > External IP. Copy the external IP.")]),t._v(" "),a("li",[t._v("Go to your DNS provider and create an A record. Paste the external IP.")]),t._v(" "),a("li",[t._v("Go to Server Settings > Maintenance > Change Domain. Paste yourdomain.com without http or https prefix.")])]),t._v(" "),a("p",[t._v("Additional documentation can be found on "),a("RouterLink",{attrs:{to:"/Deployment/ChangeDomain/"}},[t._v("domain change page")]),t._v(".")],1),t._v(" "),a("h2",{attrs:{id:"manual-deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manual-deployment"}},[t._v("#")]),t._v(" Manual Deployment")]),t._v(" "),a("h4",{attrs:{id:"how-to-manually-install-btcpay-on-ubuntu-1804"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-manually-install-btcpay-on-ubuntu-1804"}},[t._v("#")]),t._v(" How to manually install BTCPay on Ubuntu 18.04?")]),t._v(" "),a("p",[t._v("Check this "),a("a",{attrs:{href:"https://freedomnode.com/blog/114/how-to-setup-btc-and-lightning-payment-gateway-with-btcpayserver-on-linux-manual-install",target:"_blank",rel:"noopener noreferrer"}},[t._v("community guide"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"how-do-i-completely-uninstall-btcpay-from-a-linux-environment-docker-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-do-i-completely-uninstall-btcpay-from-a-linux-environment-docker-version"}},[t._v("#")]),t._v(" How do I completely uninstall BTCPay from a linux environment (docker version)")]),t._v(" "),a("ol",[a("li",[t._v("Shutdown BTCPay Server (after you ensure you have required backups etc) with "),a("code",[t._v("btcpay-down.sh")]),t._v(" and cleanup the install with "),a("code",[t._v("btcpay-clean.sh")]),t._v(".")]),t._v(" "),a("li",[t._v("Change to your Base install directory "),a("code",[t._v('cd "$(dirname "$BTCPAY_ENV_FILE")"')])]),t._v(" "),a("li",[t._v("Delete all volumes in /var/lib/docker/volumes/ with "),a("code",[t._v("docker-compose -f $BTCPAY_DOCKER_COMPOSE down --v")])]),t._v(" "),a("li",[t._v("Remove other BTCPay system files with this: "),a("code",[t._v("rm /etc/systemd/system/btcpayserver.service && rm /etc/profile.d/btcpay-env.sh")])]),t._v(" "),a("li",[t._v("Go into /usr/local/bin and remove all of the symlinks that BTCPay put in there.  At the time of writing these were:")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("bitcoin-cli.sh -> /root/BTCPayServer/btcpayserver-docker/bitcoin-cli.sh\nbitcoin-lncli.sh -> /root/BTCPayServer/btcpayserver-docker/bitcoin-lncli.sh\nbtcpay-admin.sh -> /root/BTCPayServer/btcpayserver-docker/btcpay-admin.sh\nbtcpay-clean.sh -> /root/BTCPayServer/btcpayserver-docker/btcpay-clean.sh\nbtcpay-down.sh -> /root/BTCPayServer/btcpayserver-docker/btcpay-down.sh\nbtcpay-restart.sh -> /root/BTCPayServer/btcpayserver-docker/btcpay-restart.sh\nbtcpay-setup.sh -> /root/BTCPayServer/btcpayserver-docker/btcpay-setup.sh\nbtcpay-up.sh -> /root/BTCPayServer/btcpayserver-docker/btcpay-up.sh\nbtcpay-update.sh -> /root/BTCPayServer/btcpayserver-docker/btcpay-update.sh\nchangedomain.sh -> /root/BTCPayServer/btcpayserver-docker/changedomain.sh\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[t._v("Remove your BTCPay installation folder with "),a("code",[t._v('rm -r "$(dirname "$BTCPAY_ENV_FILE")"')])]),t._v(" "),a("li",[t._v("Just to make sure, run "),a("code",[t._v("docker system prune")]),t._v(" after a reboot to get rid of any other docker related artifacts.")])]),t._v(" "),a("h3",{attrs:{id:"how-to-deploy-btcpay-server-alongside-existing-bitcoin-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-deploy-btcpay-server-alongside-existing-bitcoin-node"}},[t._v("#")]),t._v(" How to deploy BTCPay Server alongside existing Bitcoin node?")]),t._v(" "),a("p",[t._v("The instructions below are valid for Docker deployments:")]),t._v(" "),a("ul",[a("li",[t._v("Run setup as described in "),a("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker#full-installation-for-technical-users",target:"_blank",rel:"noopener noreferrer"}},[t._v("btcpayserver-docker"),a("OutboundLink")],1),t._v(" up until "),a("code",[t._v(". ./btcpay-setup.sh -i")])]),t._v(" "),a("li",[t._v("Create "),a("code",[t._v("bitcoin.custom.yml")]),t._v(" in the "),a("code",[t._v("docker-compose-generator/docker-fragments/")]),t._v(" folder.")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("btcpayserver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BTCPAY_CHAINS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btc"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BTCPAY_BTCEXPLORERURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//nbxplorer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("32838/\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nbxplorer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_CHAINS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btc"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_BTCRPCURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//host.docker.internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("43782/\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_BTCRPCUSER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rpc-username"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_BTCRPCPASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rpc-password"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NBXPLORER_BTCNODEENDPOINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" host.docker.internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("39388")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localBitcoinfolder:/root/.bitcoin"')]),t._v("\n")])])]),a("ul",[a("li",[t._v("Replace: "),a("code",[t._v("43782")]),t._v(" with your bitcoin node's configured RPC port")]),t._v(" "),a("li",[t._v("Replace: "),a("code",[t._v("rpc-username")]),t._v(" with your bitcoin node's configured RPC username")]),t._v(" "),a("li",[t._v("Replace: "),a("code",[t._v("rpc-password")]),t._v(" with your bitcoin node's configured RPC password")]),t._v(" "),a("li",[t._v("Replace: "),a("code",[t._v("39388")]),t._v(" with your bitcoin node's configured p2p port")]),t._v(" "),a("li",[t._v("Replace "),a("code",[t._v("localBitcoinfolder")]),t._v(" with the path to your bitcoin data folder")])]),t._v(" "),a("p",[t._v("If you are running on linux, due to "),a("a",{attrs:{href:"https://github.com/docker/for-linux/issues/264",target:"_blank",rel:"noopener noreferrer"}},[t._v("a limitation of docker"),a("OutboundLink")],1),t._v(", you will also need to do the following:")]),t._v(" "),a("ul",[a("li",[t._v("Run "),a("code",[t._v("ip route | grep docker0 | awk '{print $9}'")]),t._v(" "),a("ul",[a("li",[t._v("Add the following at the end of the "),a("code",[t._v("bitcoin.custom.yml")]),t._v(" file, replacing "),a("code",[t._v("$DOCKER_HOST_IP")]),t._v(" with the result of the previous command.")])])])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[t._v("      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host.docker.internal:$DOCKER_HOST_IP"')]),t._v("\n")])])]),a("ul",[a("li",[t._v("Run "),a("code",[t._v('BTCPAYGEN_EXCLUDE_FRAGMENTS="bitcoin"')])]),t._v(" "),a("li",[t._v("Run "),a("code",[t._v('BTCPAYGEN_ADDITIONAL_FRAGMENTS="$BTCPAYGEN_ADDITIONAL_FRAGMENTS"')])]),t._v(" "),a("li",[t._v("Run "),a("code",[t._v(". ./btcpay-setup.sh -i")])])]),t._v(" "),a("p",[t._v("If you are looking for how to deploy alongside existing Lightning node "),a("RouterLink",{attrs:{to:"/FAQ/LightningNetwork/#can-i-use-my-existing-ln-node-with-btcpay"}},[t._v("see this")]),t._v(".")],1),t._v(" "),a("h3",{attrs:{id:"with-the-docker-deployment-how-to-use-a-different-volume-for-the-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#with-the-docker-deployment-how-to-use-a-different-volume-for-the-data"}},[t._v("#")]),t._v(" With the docker deployment, how to use a different volume for the data?")]),t._v(" "),a("p",[t._v("First, you need to make sure that btcpayserver and docker is not running")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" -\nbtcpay-down.sh\nsystemctl stop "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n")])])]),a("p",[t._v("Now, you need to format your drive. If you have already done it, you can skip this step.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step 1: Unplug the drive")]),t._v("\nlsblk\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Step 2: Plug the drive")]),t._v("\nlsblk\n")])])]),a("p",[t._v("The second "),a("code",[t._v("lsblk")]),t._v(" should show the drive you just plugged in. (of TYPE "),a("code",[t._v("disk")]),t._v(")\nMake sure you don't make a mistake as the next command will erase all data on this disk.")]),t._v(" "),a("p",[t._v("For the sake of the example, let's suppose it has the NAME "),a("code",[t._v("/dev/sdd")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Save the name in a variable")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DEVICE_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/dev/sdd"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set the partition name")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PARTITION_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/dev/sdd1"')]),t._v("\n")])])]),a("p",[t._v("Now we can partition the disk and format the partition:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Partitioning the external drive '),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DEVICE_NAME")]),t._v('..."')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### DANGER ZONE ###")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" o "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a new empty DOS partition table")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Add a new partition")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" p "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Primary partition")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Partition number")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# First sector (Accept default: 1)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Last sector (Accept default: varies)")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" w "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Write changes")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fdisk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${DEVICE_NAME}")]),t._v("\npartprobe "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${DEVICE_NAME}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" lsblk "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PARTITION_NAME")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&>")]),t._v(" /dev/null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nmkfs.ext4 -F "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PARTITION_NAME")]),t._v('"')]),t._v("\n")])])]),a("p",[t._v("Then we need to mount the partition on the linux filesystem.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Mounting the partition")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MOUNT_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/mnt/external"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" -o defaults,noatime "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PARTITION_NAME")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Make sure the partition exists at the next reboot, we use UUID in case")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the partition name is different in the next reboot")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -qF "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v(" /etc/fstab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("UUID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" blkid -s UUID -o value $PARTITION_NAME"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UUID='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$UUID")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v(' ext4 defaults,noatime,nofail 0 2"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/fstab\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),a("p",[t._v("Then, we need to make sure that docker not start before the mount.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MOUNT_UNIT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("systemd-escape --path "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v('.mount"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("docker_service")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/lib/systemd/system/docker.service"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -qF "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"After='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_UNIT")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker_service")]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"s/After=/After='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_UNIT")]),t._v(' /g"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$docker_service")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),a("p",[t._v("Now, imagine you want to put all the docker volume data on the previous partition")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DOCKER_VOLUMES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Copy all the data from our volume to the mount directory (this can take a while)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -a -r "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('/."')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Make the folder a mountpoint")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" --bind "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Make sure the mountpoint is mounted after reboot")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" -qF "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v('"')]),t._v(" /etc/fstab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MOUNT_DIR")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_VOLUMES")]),t._v(' none bind,nobootwait 0 2"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/fstab\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])]),a("p",[t._v("Now restart docker and btcpayserver")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("systemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\nbtcpay-up.sh\n")])])]),a("p",[t._v("Note: We use mount bind instead of symbolic link because docker would complain when running "),a("code",[t._v("docker volume rm")]),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"i-get-503-service-temporarily-unavailable-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#i-get-503-service-temporarily-unavailable-nginx"}},[t._v("#")]),t._v(" I get 503 Service Temporarily Unavailable nginx")]),t._v(" "),a("h4",{attrs:{id:"cause-1-trying-to-access-my-btcpay-by-ip-address"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cause-1-trying-to-access-my-btcpay-by-ip-address"}},[t._v("#")]),t._v(" Cause 1: Trying to access my BTCPay by IP address")]),t._v(" "),a("p",[t._v("Your nginx config is set to route the HTTP request to a particular container based on the domain name of the request. For example, the official "),a("RouterLink",{attrs:{to:"/Deployment/RPi4/"}},[t._v("deployment on pi 4")]),t._v(" was to setup the souce domain name to http://raspberrypi.local/ yet getting automatic local domain raspberrypi.local does not always work. You are probably in this situation and trying to type the IP address of your BTCPay into the web-browser.")],1),t._v(" "),a("p",[t._v("Since nginx gets the IP address in the request instead of raspberrypi.local it does not know where to route that request and returns:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("503 Service Temporarily Unavailable\n-----------------------------------\nnginx\n")])])]),a("p",[t._v("You can fix this by forcing nginx to route the HTTP request to BTCPay even if the request domain name is not recognized.\nSimply, re-run the setup script like this:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" -\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("REVERSEPROXY_DEFAULT_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BTCPAY_HOST")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" btcpay-setup.sh -i\n")])])]),a("p",[t._v("Now putting local IP in the web-browser works.")]),t._v(" "),a("h4",{attrs:{id:"cause-2-btcpayserver-or-letsencrypt-nginx-proxy-is-not-running"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cause-2-btcpayserver-or-letsencrypt-nginx-proxy-is-not-running"}},[t._v("#")]),t._v(" Cause 2: btcpayserver or letsencrypt-nginx-proxy is not running")]),t._v(" "),a("p",[t._v("To check, run:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("less")]),t._v(" -S\n")])])]),a("p",[t._v('Press "q" to quit out of less.')]),t._v(" "),a("p",[t._v("The output should contain:")]),t._v(" "),a("ul",[a("li",[t._v("btcpayserver/letsencrypt-nginx-proxy-companion")]),t._v(" "),a("li",[t._v("btcpayserver/btcpayserver")])]),t._v(" "),a("p",[t._v('And the status should be "Up"')]),t._v(" "),a("p",[t._v("If the docker container is not running, then check the reason for crash like this:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs 6a6b9fd75692 --tail "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n")])])]),a("p",[t._v("Where 6a6b9fd75692 is the container ID that is having issues.")]),t._v(" "),a("h4",{attrs:{id:"cause-3-btcpay-is-expecting-you-to-access-this-website-from"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cause-3-btcpay-is-expecting-you-to-access-this-website-from"}},[t._v("#")]),t._v(" Cause 3: BTCPay is expecting you to access this website from")]),t._v(" "),a("p",[t._v("You might also see the following error: "),a("code",[t._v("You access BTCPay Server over an unsecured network")]),t._v(".")]),t._v(" "),a("p",[t._v("You might see this error on the front page of your BTCPay Server since version "),a("code",[t._v("1.0.3.73")]),t._v(".")]),t._v(" "),a("p",[t._v("This is caused by a breaking change made in BTCPay to be able to handle different domain on the same server.")]),t._v(" "),a("p",[t._v("It happens because your BTCPay Server is not exposed directly on internet, instead a reverse proxy (like nginx or IIS) receive the request and forward it to BTCPay Server.")]),t._v(" "),a("p",[t._v("Sadly, depending on the configuration of your reverse proxy, either the HTTP HOST header has been replaced, or the reverse proxy did not forwarded the protocol at the front with the http header "),a("code",[t._v("X-Forwarded-Proto")]),t._v(".")]),t._v(" "),a("p",[t._v("If you use NGinx, here is what you need to have at the top level in "),a("code",[t._v("/etc/nginx/conf.d/default.conf")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_proto")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_x_forwarded_proto")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_x_forwarded_proto")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ''      $scheme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v(" X-Forwarded-Proto "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_x_forwarded_proto")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_names_hash_bucket_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffer_size")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffers")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_busy_buffers_size")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_header_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("large_client_header_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http2_max_field_size")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http2_max_header_size")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500k")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("If your reverse proxy is Apache 2, you need to set those two settings")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<VirtualHost *:443>\n    RequestHeader set X-Forwarded-Proto "https"\n    ProxyPreserveHost on\n...\n</VirtualHost>\n')])])]),a("p",[t._v("You will also need those settings in the "),a("code",[t._v("apache2.conf")]),t._v(" to prevent issues while signing PSBTs.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("LimitRequestLine 500000\nLimitRequestFieldSize 500000\n")])])]),a("h4",{attrs:{id:"cause-4-getting-500-nginx-error-on-a-local-server-https-and-for-http-btcpay-is-expecting-you-to-access-this-website-from"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cause-4-getting-500-nginx-error-on-a-local-server-https-and-for-http-btcpay-is-expecting-you-to-access-this-website-from"}},[t._v("#")]),t._v(" Cause 4: Getting 500 nginx error on a local server https and for http BTCPay is expecting you to access this website from")]),t._v(" "),a("p",[t._v("You need to open port 80 and 443. Once you did that, restart docker "),a("code",[t._v("btcpay-restart.sh")])]),t._v(" "),a("h4",{attrs:{id:"cause-5-other"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cause-5-other"}},[t._v("#")]),t._v(" Cause 5: Other")]),t._v(" "),a("p",[t._v("There could be many causes for 5XX HTTP errors. Please create an "),a("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver-docker/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("Issue"),a("OutboundLink")],1),t._v(" and when cause becomes known add it here in the "),a("RouterLink",{attrs:{to:"/FAQ/Deployment/"}},[t._v("Deployment FAQ")]),t._v(" doc.")],1)])}),[],!1,null,null,null);e.default=n.exports}}]);